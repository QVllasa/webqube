<ng-container *ngIf="project$ | async as project">
  <ng-container *ngIf="project.planID">

    <h2 class="mt-8 text-center text-2xl font-extrabold tracking-tight text-gray-900 sm:text-4xl">
      <span class="block">Verfolge jeden Fortschritt.</span>
      <span class="block mt-4 text-lg font-medium text-gray-500">Hier kannst du in jeder Phase deine Wünsche und
        Anforderungen präzise aufschreiben.</span>
    </h2>
      <ng-container *ngIf=" (boards$ | async) as boards">
        <div class="mt-8">
          <div class="hidden sm:block">
              <nav class="-mb-px flex space-x-8 justify-center" aria-label="Tabs">
                <!-- Current: "border-indigo-500 text-indigo-600", Default: "border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" -->
                <button *ngFor="let board of sortBoardsByOrder(boards)"
                        (click)="onSelectBoard(board, boards)"
                   [ngClass]="board.selected ? 'bg-amber-100 text-amber-700 ': 'hover:bg-gray-50'"
                   class="relative text-gray-500  px-3 py-2 font-medium text-sm rounded-md">
                  <span>{{board.label}}</span>
                </button>
              </nav>
          </div>
        </div>
        <div>
          <div class="mt-16 h-full w-full overflow-hidden" fxLayout="column">
            <div *ngIf="isLoading" class="flex justify-center items-center p-16">
              <mat-spinner [diameter]="40"></mat-spinner>
            </div>
            <ng-container *ngIf="!isLoading">
              <ng-container *ngFor="let board of boards">
                <ng-container *ngIf="board.selected">
                  <div class="py-8 flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-700 m-0">{{board.label}}</h2>
                    <button *ngIf="!board.paid" mat-ripple (click)="payMilestone(board)" type="button"
                            class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-amber-600 hover:bg-amber-700 focus:outline-none ">
                      <mat-icon class="material-symbols-rounded mr-3">flag</mat-icon>
                      Freigabe erteilen
                    </button>
                  </div>
                  <div class="min-h-0 w-full grid grid-cols-3 overflow-scroll relative"
                       fxFlex="auto"
                       fxLayout="row"
                       fxLayoutAlign="start start"
                       fxLayoutGap="24px">

                    <!--    Columns -->
                    <ng-container *ngIf="lists$ | async as lists">
                      <div *ngFor="let list of sortListsByOrder(lists); let i=index"
                           cdkDragHandle
                           class="relative h-full rounded bg-gray-50 overflow-hidden max-h-full col-span-1  hover:bg-gray-100"
                           fxFlex="none"
                           fxLayout="column">

                        <div  class="p-4 cursor-pointer flex justify-between items-center text-gray-600 "
                              fxFlex="none">
                          <h2 class=" text-base font-semibold m-0 select-none" fxFlex="none">{{ list.label }}</h2>

                          <button (click)="createCard(list)" mat-ripple type="button"
                                  class="inline-flex items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-amber-600 hover:bg-amber-700 focus:outline-none">
                            Neu
                          </button>
                        </div>

                        <div cdkDragHandle class="flex-auto ">
                          <div (cdkDropListDropped)="drop($event)"
                               [cdkDropListConnectedTo]="getConnectedList(lists)"
                               [cdkDropListData]="list.cards"
                               cdkDropList
                               class="px-4 pb-4 min-h-full"
                               id="{{ list.id }}">
                            <div (click)="updateCard(board, list, card)"
                                 *ngFor="let card of list.cards"
                                 [cdkDragData]="card"
                                 cdkDrag
                                 class="my-2 bg-white shadow rounded-lg cursor-grab  ">
                              <div class="p-4 text-left">
                                <div *ngIf="card.labels?.length > 0" class="mb-2" fxLayout="row" fxLayoutGap="8px">
                                  <div *ngFor="let label of card.labels"
                                       [ngClass]="label.bgClass"
                                       class="label"
                                       fxFlex></div>
                                </div>

                                <h3 class="font-semibold text-xs">{{ card.title }}</h3>

                              </div>
                            </div>
                          </div>
                        </div>
                        <div *ngIf="i !== 0 && !board.paid"
                             [matTooltip]="'Der Meilenstein '+board.label +' muss erst freigeschaltet werden.'"
                             class="absolute w-full h-full bg-gray-300 top-0 left-0 bottom-0 right-0 opacity-50"></div>

                      </div>
                    </ng-container>


                  </div>
                </ng-container>
              </ng-container>
            </ng-container>


          </div>
        </div>
      </ng-container>

  </ng-container>
  <div *ngIf="!project.planID">
    <app-select-plan
      headline="Wähle ein Paket aus."
      subheadline="Du zahlst erst nach Freigabe eines Meilensteins."
      [bookCall]="false"
      [project]="project"></app-select-plan>
  </div>
</ng-container>


