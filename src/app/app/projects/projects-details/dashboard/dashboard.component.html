<form [formGroup]="form" *ngIf="user && project$|async as project">
  <div class="px-4 py-5 sm:px-6 flex justify-between items-center">
    <div class="w-64">
      <h3 class="text-lg leading-6 font-medium text-gray-900">
        <input type="text"
               formControlName="title"
               (focusout)="updateTitle()"
               name="title" id="title"
               class="-pl-1 flex-auto cursor-pointer text-lg text-gray-600 font-normal focus:text-sm focus:font-normal  focus:cursor-text focus:bg-white hover:bg-gray-100 w-full border-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500 block  rounded-md"
               placeholder="Projekttitel">
      </h3>
    </div>
    <div class="w-64 flex justify-center">
      <span
        class="inline-flex items-center px-2.5 py-0.5 rounded-md text-base font-medium bg-gray-100 text-gray-800">
        <!--        {{project.planID ? getPlan(project.planID) : 'Kein Plan ausgewählt'}}-->
      </span>
    </div>
    <div class=" w-64 flex justify-end">
      <button mat-icon-button [matMenuTriggerFor]="menu">
        <mat-icon class="material-symbols-rounded">more_vert</mat-icon>
      </button>
    </div>


  </div>
  <dl class="sm:divide-y sm:divide-gray-200">
    <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
      <dt class="text-sm font-medium text-gray-500">
        Besitzer
      </dt>
      <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
        {{user.displayName}}
      </dd>
    </div>
    <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6 flex items-center">
      <dt class=" text-sm font-medium text-gray-500">
        Deine Wunschdomain
      </dt>
      <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
        <div>
          <label for="domain" class="sr-only block text-sm font-medium text-gray-700">
            Domain
          </label>
          <div class="mt-1 flex rounded-md shadow-sm">
            <span
              class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm">
              http://
            </span>
            <input formControlName="domain" type="text" name="domain" id="domain"
                   (focusout)="checkDomain()"
                   class="flex-1 min-w-0 block w-full px-3 py-2 rounded-none rounded-r-md focus:ring-amber-500 focus:border-amber-500 sm:text-sm border-gray-300"
                   placeholder="www.example.com">
          </div>

        </div>
      </dd>
    </div>
    <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6 flex items-center">
      <dt class="text-sm font-medium text-gray-500 ">
        Hosting
      </dt>
      <!--        TODO add dialog with S, M & L Option for Hosting -->
      <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
        <button mat-ripple type="button"
                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-amber-600 hover:bg-amber-700 focus:outline-none ">
          Server hinzufügen
        </button>
      </dd>
    </div>
    <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
      <dt class="text-sm font-medium text-gray-500">
        Aktueller Stand
      </dt>
      <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
        <!--          TODO set latest paid milestone/board -->
        Nicht begonnen
      </dd>
    </div>
    <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
      <dt class="text-sm font-medium text-gray-500">
        Design
      </dt>
      <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
        -
      </dd>
    </div>
  </dl>

  <div>
    <dl class="mt-5 grid grid-cols-1 gap-5 sm:grid-cols-3">
      <div *ngFor="let feature of features(project)"
           class="px-4 py-5 bg-white shadow rounded-lg overflow-hidden sm:p-6">
        <dt class="text-sm font-medium text-gray-500 truncate">{{feature.value.title}}</dt>
        <dd class="flex items-center">
          <p matTooltip="Verwendet" matTooltipPosition="below"
             class="mt-1 text-xl font-semibold text-gray-900">{{feature.value.used}} </p><span
          class="mx-1 text-lg text-gray-300">/</span>
          <p matTooltip="Verfügbar" matTooltipPosition="below"
             class="mt-1 text-lg font-semibold text-gray-300">{{feature.value.value}}</p>
        </dd>
      </div>
    </dl>
  </div>
</form>

<!-- This example requires Tailwind CSS v2.0+ -->


<ng-container *ngIf=" !isDeleting && project$ |async as project">
  <form [formGroup]="form" *ngIf="user" class="divide-y divide-gray-200 lg:col-span-9">
    <div *ngIf="!project.planID" class="bg-white">
      <div class="max-w-7xl mx-auto text-center py-12 px-4 sm:px-6 lg:py-16 lg:px-8">
        <h2 class="text-2xl font-extrabold tracking-tight text-gray-900 sm:text-4xl">
          <span class="block">Bereit loszulegen?</span>
          <span class="block mt-4 text-lg font-medium text-gray-500">Besprich mit uns in einem Call dein
            Projekt.</span>
        </h2>
        <div class="mt-8 flex justify-center items-center">
          <div class="inline-flex rounded-md shadow">
            <a href="https://calendly.com/webqube/30min" target="_blank"
               class="inline-flex items-center justify-center px-5 py-3 border border-transparent text-base font-medium rounded-md text-white bg-amber-600 hover:bg-amber-700">
              Termin buchen
            </a>
          </div>
        </div>
        <h2 class="text-2xl font-extrabold tracking-tight text-gray-900 sm:text-4xl">
          <span class="block mt-8 text-lg font-medium text-gray-500">oder gleich loslegen.
            <br>
            Wähle dazu einfach einen Plan aus.
          </span>
        </h2>
        <!-- This example requires Tailwind CSS v2.0+ -->
        <fieldset>
          <div
            class="relative mt-8 grid grid-cols-1 gap-y-6 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3  sm:gap-x-4">
            <!--
              Checked: "border-transparent", Not Checked: "border-gray-300"
              Active: "ring-2 ring-amber-500"
            -->
            <label *ngFor="let plan of plans"
                   [ngClass]="isSelected(plan) ? 'border-transparent ring-2 ring-amber-500':'border-gray-300'"
                   class="relative bg-white border  rounded-lg shadow-sm p-4 flex cursor-pointer focus:outline-none">
              <input [value]="isSelected(plan)" type="radio" name="project-type" value="Newsletter"
                     class="sr-only"
                     (click)="onSelectTier(plan)"
                     aria-labelledby="project-type-0-label"
                     aria-describedby="project-type-0-description-0 project-type-0-description-1">
              <div class="flex-1 flex">
                <div class="flex flex-col relative h-32">
                  <span id="project-type-0-label" class="block text-left text-sm font-semibold text-gray-800">
                    {{plan.label}}
                  </span>
                  <span id="project-type-0-description-0"
                        class="mt-1 text-left flex items-center text-sm text-gray-500">
                    {{plan.description}}
                  </span>
                  <span class="absolute bottom-0 text-lg font-semibold text-gray-900">
                    {{plan.price}}€ /Projekt
                  </span>
                </div>
              </div>
              <mat-icon [ngClass]="isSelected(plan) ? '':'invisible'"
                        class="material-symbols-rounded h-5 w-5 text-amber-600">
                task_alt
              </mat-icon>
              <div [ngClass]="isSelected(plan) ? 'border border-amber-500':'border-2 border-transparent'"
                   class="absolute -inset-px rounded-lg border-2 pointer-events-none"
                   aria-hidden="true"></div>
            </label>
            <div *ngIf="isSavingTier"
                 class="absolute top-0 left-0 right-0 bottom-0 bg-gray-50 opacity-30 rounded-lg"></div>
          </div>
        </fieldset>
        <ng-container *ngIf="plan$ | async as plan">
          <button [disabled]="isSavingTier" (click)="initProject(plan)"
                  class="w-48 mt-6 inline-flex items-center justify-center px-5 py-3 border border-transparent text-base font-medium rounded-md text-white bg-amber-600 hover:bg-amber-700">
            <span *ngIf="!isSavingTier">Weiter</span>
            <mat-spinner customSpinner color="#FEFCFA" *ngIf="isSavingTier" [diameter]="20"></mat-spinner>
          </button>
        </ng-container>

      </div>
    </div>

  </form>
</ng-container>


<mat-menu xPosition="before" #menu="matMenu">
  <button (click)="deleteProject()" mat-menu-item>
    <mat-icon class="material-symbols-rounded">delete</mat-icon>
    Projekt löschen
  </button>
</mat-menu>
<div *ngIf="isDeleting" class="bg-white shadow overflow-hidden sm:rounded-lg h-96 flex justify-center items-center">
  <mat-spinner diameter="50" color="#f59e0b" customSpinner></mat-spinner>
</div>
